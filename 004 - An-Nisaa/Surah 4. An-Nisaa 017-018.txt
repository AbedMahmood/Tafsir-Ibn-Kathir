Tafsir Ibn Kathir- Surah 4. An-Nisaa, Ayaat 17 To 18

إِنَّمَا التَّوْبَةُ عَلَى اللَّهِ لِلَّذِينَ يَعْمَلُونَ السُّوءَ بِجَهَالَةٍ ثُمَّ يَتُوبُونَ مِنْ قَرِيبٍ فَأُولَٰئِكَ يَتُوبُ اللَّهُ عَلَيْهِمْ ۗ وَكَانَ اللَّهُ عَلِيمًا حَكِيمًا١٧وَلَيْسَتِ التَّوْبَةُ لِلَّذِينَ يَعْمَلُونَ السَّيِّئَاتِ حَتَّىٰ إِذَا حَضَرَ أَحَدَهُمُ الْمَوْتُ قَالَ إِنِّي تُبْتُ الْآنَ وَلَا الَّذِينَ يَمُوتُونَ وَهُمْ كُفَّارٌ ۚ أُولَٰئِكَ أَعْتَدْنَا لَهُمْ عَذَابًا أَلِيمًا١٨
17. Allah accepts only the repentance of those who do evil in ignorance and foolishness and repent soon ﴿afterwards﴾; it is they to whom Allah will forgive and Allah is Ever All-Knower, All-Wise. 18. And of no effect is the repentance of those who continue to do evil deeds until death faces one of them and he says: "Now I repent;'' nor of those who die while they are disbelievers. For them, We have prepared a painful torment.

Repentance is Accepted Until one Faces death

Allah states that He accepts repentance of the servant who commits an error in ignorance and then repents, even just before he sees the angel who captures the soul, before his soul reaches his throat. Mujahid and others said, "Every person who disobeys Allah by mistake, or intentionally is ignorant, until he refrains from the sin.'' Qatadah said that Abu Al-`Aliyah narrated that the Companions of the Messenger of Allah used to say, "Every sin that the servant commits, he commits out of ignorance.'' `Abdur-Razzaq narrated that, Ma`mar said that Qatadah said that, the Companions of the Messenger of Allah agreed that every sin that is committed by intention or otherwise, is committed in ignorance.'' Ibn Jurayj said, "Abdullah bin Kathir narrated to me that Mujahid said, `Every person who disobeys Allah (even willfully), is ignorant while committing the act of disobedience.''' Ibn Jurayj said, "`Ata' bin Abi Rabah told me something similar.'' Abu Salih said that Ibn `Abbas commented, "It is because of one's ignorance that he commits the error.'' `Ali bin Abi Talhah reported that Ibn `Abbas said about the Ayah,

﴿ثُمَّ يَتُوبُونَ مِن قَرِيبٍ﴾
(and repent soon (afterwards)), "Until just before he (or she) looks at the angel of death.'' Ad-Dahhak said, "Every thing before death is `soon ﴿afterwards﴾.''' Al-Hasan Al-Basri said about the Ayah,

﴿ثُمَّ يَتُوبُونَ مِن قَرِيبٍ﴾
(and repent soon afterwards), "Just before his last breath leaves his throat.'' `Ikrimah said, "All of this life is `soon ﴿afterwards﴾.''' Imam Ahmad recorded that Ibn `Umar said that the Messenger said,

«إِنَّ اللهَ يَقْبَلُ تَوْبَةَ الْعَبْدِمَالَمْ يُغَرْغِر»
(Allah accepts the repentance of the servant as long as the soul does not reach the throat.) This Hadith was also collected by At-Tirmidhi and Ibn Majah, and At-Tirmidhi said, "Hasan Gharib''. By mistake, Ibn Majah mentioned that this Hadith was narrated through `Abdullah bin `Amr. However, what is correct is that `Abdullah bin `Umar bin Al-Khattab was the narrator. Allah said,

﴿فَأُوْلَـئِكَ يَتُوبُ اللَّهُ عَلَيْهِمْ وَكَانَ اللَّهُ عَلِيماً حَكِيماً﴾
(It is they to whom Allah will forgive and Allah is Ever All-Knower, All-Wise.) Surely, when hope in continued living diminishes, the angel of death comes forth and the soul reaches the throat, approaches the chest and arrives at the state where it is being gradually pulled out, then there is no accepted repentance, nor a way out of that certain end. Hence Allah's statements,

﴿وَلَيْسَتِ التَّوْبَةُ لِلَّذِينَ يَعْمَلُونَ السَّيِّئَـتِ حَتَّى إِذَا حَضَرَ أَحَدَهُمُ الْمَوْتُ قَالَ إِنِّى تُبْتُ الاٌّنَ﴾
(And of no effect is the repentance of those who continue to do evil deeds until death faces one of them and he says: "Now I repent,'') and,

﴿فَلَمَّا رَأَوْاْ بَأْسَنَا قَالُواْ ءَامَنَّا بِاللَّهِ وَحْدَهُ﴾
(So when they saw Our punishment, they said: "We believe in Allah Alone...'') ﴿40:84﴾ Allah decided that repentance shall not be accepted from the people of the earth when the sun rises from the west, as Allah said,

﴿يَوْمَ يَأْتِى بَعْضُ ءَايَـتِ رَبِّكَ لاَ يَنفَعُ نَفْسًا إِيمَانُهَا لَمْ تَكُنْ ءَامَنَتْ مِن قَبْلُ أَوْ كَسَبَتْ فِى إِيمَـنِهَا خَيْرًا﴾
(The day that some of the signs of your Lord do come, no good will it do to a person to believe then, if he believed not before, nor earned good through his faith.) ﴿6:158﴾. oAllah said,

﴿وَلاَ الَّذِينَ يَمُوتُونَ وَهُمْ كُفَّارٌ﴾
(nor of those who die while they are disbelievers.) Consequently, when the disbeliever dies while still a disbeliever and polytheist, his sorrow and repentance shall not avail him. If he were to ransom himself, even with the earth's fill of gold, it will not be accepted from him. Ibn `Abbas, Abu Al-`Aliyah and Ar-Rabi` bin Anas said that the Ayah:

﴿وَلاَ الَّذِينَ يَمُوتُونَ وَهُمْ كُفَّارٌ﴾
(nor of those who die while they are disbelievers), was revealed about the people of Shirk. Imam Ahmad recorded that Usamah bin Salman said that Abu Dharr said that the Messenger of Allah said,

«إِنَّ اللهَ يَقْبَلُ تَوْبَةَ عَبْدِهِ أَوْ يَغْفِرُ لِعَبْدِهِ مَالَمْ يَقَعِ الْحِجَاب»
(Allah accepts the repentance of His servant, or forgives His servant, as long as the veil does not drop.) They asked, "And what does the drop of the veil mean '' He said,

«أَنْ تَخْرُجَ النَّفْسُ وَهِيَ مُشْرِكَة»
(When the soul is removed while one is a polythiest.) Allah then said,

﴿أُوْلَـئِكَ أَعْتَدْنَا لَهُمْ عَذَاباً أَلِيماً﴾
(For them We have prepared a painful torment), torment that is severe, eternal and enormous.